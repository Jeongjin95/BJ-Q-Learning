Will post all code after revision.
